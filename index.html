<!DOCTYPE html>
<!--[if lte IE 6]><html class="preIE7 preIE8 preIE9"><![endif]-->
<!--[if IE 7]><html class="preIE8 preIE9"><![endif]-->
<!--[if IE 8]><html class="preIE9"><![endif]-->
<!--[if gte IE 9]><!--><html lang="en"><!--<![endif]-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title id="bigred">Big Red Bot</title>
    <link rel="icon" href="img/cor.png" type="image/cornell">
    <link rel="stylesheet" href="css/main.css" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato%7COpen+Sans%7CCinzel:700%7CPacifico%7COswald" rel="stylesheet">
</head>
<body>
    <div id="fb-root"></div>
    <div id="primary-out">
    <div class="nav">
      <ul>
        <li class="home"><a href="#bigred">Home</a></li>
        <li class="design"><a href="#design">Design</a></li>
		<li class="result"><a href="#result">Result</a></li>
        <li class="team"><a href="#team">Team</a></li>
        <li class="code"><a href="https://github.com/rxhl/Big-Red-Bot" target="_blank">Code</a></li>
      </ul>
    </div>
	<div id="title"><h1>Big Red Bot</h1></div>             
    <hr style="width: 95%">
    <div id="primary-in">
    <h2 class="Heading">Objective</h2> 
	<p class="contents">The primary objective of the project is to create a robot that can be maneuvered remotely using any device connected to the internet, in a secure manner. The bot employs a Raspberry Pi 2 Model B at its core, gives a live video feed using camera module and hosts a Flask server that contains the GUI to control the bot. The Flask application also conducts user authentication to provide access to registered users only.</p><br>   
    <hr style="width: 100%">
    <h2 class="Heading"	>Introduction</h2>
    <p class="contents">Playing with remote controlled gears is an engaging experience, which almost everyone has gone through while growing up. Taking the same essence forward, we built the Big-Red-Bot (BRB) which is a Raspberry Pi powered bot capable of being controlled by any device over Wi-Fi viz. laptop, tablet and mobile. The bot is controlled via a Flask app which is hosted on the Pi itself and commands can be sent to the bot through HTTP request from the user's device.<br><br>
	As soon as a user accesses BRB's IP address, he/she is presented with a login screen. The user can access the maneuver dashboard only after a successful login. New users can be added only by admins. The bot, upon receiving the commands from the user, calls appropriate functions to control the two servo motors to go forward/backward/left/right and vary its speed. The bot also has a camera module attached to it that provides a live video feed of the path. 
	</p><br><hr>
    <h2 class="Heading" id="design">Design &amp; Testing</h2>
	<h3 class="Heading">Overview</h3>
    <p class="contents">The design and testing process is broadly divided in three phases - Network, Web App and Motor Control. Before we dive deep in any of them, below is a block diagram [Fig. 1] that summarizes the complete design process.</p>
		
	<figure>	
	<img class="conn" src="" alt="Block Diagram">
	<figcaption><span class="caption">Fig. 1. Block diagram of the system</span></figcaption>
	</figure>
		
	<p class="contents">As shown above, Pi houses both the server (Flask) and the motor control module. Once the user successfully logs in, the server renders a HTML document containing a dashboard to control the bot as well as display the camera feed.<br></p>
	<h3 class="Heading">Network</h3>
	<p class="contents">
	To provide wireless capabilities to the bot, we used the Edimax Wi-Fi module [1]. We implemented two types of network connections for this project i.e. Ad Hoc and regular Wi-Fi. The main advantage of Ad Hoc is that it does not require any external Wi-Fi to connect to the client. The client can simply join the Ad Hoc and access bot controls. This is particularly useful when the user wants to take the bot outdoors where there is no Wi-Fi. The steps to configure an Ad Hoc network [2] on Pi are below.<br><br>
	First, open the network interfaces file for editing.</p>
		
	<div class="coder"><code>&#36; sudo nano /etc/network/interfaces</code></div>
		
	<p class="contents">Next, edit the file as follows.</p>
		
	<div class="coder"><code>auto lo</code><br>
	<code>iface lo inet loopback</code><br>
	<code>iface eth0 inet dhcp</code><br><br>
 
	<code>auto wlan0</code><br>
	<code>iface wlan0 inet static</code><br>
  	<code>address 192.168.1.1</code><br>
  	<code>netmask 255.255.255.0</code><br>
  	<code>wireless-channel 1</code><br>
  	<code>wireless-essid RPiAdHocNetwork</code><br>
  	<code>wireless-mode ad-hoc</code></div>
		
	<p class="contents">Now, restart the wireless connection.</p>
	
	<div class="coder"><code>&#36; sudo ifdown wlan0</code><br>
	<code>&#36; sudo ifup wlan0</code></div>
		
	<p class="contents">At this point, we have configured the Pi to host an Ad Hoc network but to make other devices connect to it and communicate effectively, we need to install the DHCP server on it so that the Pi can assign IP addresses to its clients.</p>
	
	<div class="coder"><code>&#36; sudo apt-get update</code><br>
	<code>&#36; sudo apt-get install dhcp3-server</code></div>
	
	<p class="contents">Once the installation is done, we need to update the config file.</p>
	
	<div class="coder"><code>&#36; sudo nano /etc/dhcp/dhcpd.conf</code></div>
	
	<p class="contents">Update it with the following.</p>
	
	<div class="coder"><code>ddns-update-style interim;</code><br>
	<code>default-lease-time 600;</code><br>
	<code>max-lease-time 7200;</code><br>
	<code>authoritative;</code><br>
	<code>log-facility local7;</code><br>
	<code>subnet 192.168.1.0 netmask 255.255.255.0 {</code><br>
	<code>range 192.168.1.5 192.168.1.150;}</code></div>

	<p class="contents">The Pi is now ready to communicate with the client. However, we observed that the Ad Hoc method worked successfully only with a PC and not any other platform. We were able to connect iOS and OS X devices to the Ad Hoc netowork hosted by the Pi but could not access the web application. To overcome this problem, we used both the Wi-Fi adapters available on the Pi. We configured <code>wlan0</code> for hosting an Ad Hoc network and <code>wlan1</code> as a regular client which would connect to an external Wi-Fi. So far, we have successfully set up our network and can move ahead to setting up our web application.</p><br>
	
	<h3 class="Heading">Web App</h3>
	<p class="contents">The layout of the web application is as follows.</p>
	
	<ul class="lister">
		<li>../control.html</li>
		<li>../login.html</li>
		<li>controller.py</li>
		<li>server.py</li>
		<li>run_test.py</li>
	</ul>
	
	
	<p class="contents">
	<code>controller.py</code> is the main program that renders both the web pages. <code>login.html</code> is the first web page that gets loaded and checks for userID and password. Once authenticated, the next page loads which acts as a dashboard to control the bot. <code>run_test.py</code> contains the code for controlling motor by varying duty cycle. Due to this, we can keep our main program uncluttered and simply call <code>run_test.py</code> from <code>controller.py</code>. <code>server.py</code> is another script which was developed as an extension to this project. It basically logs all the details including users who logged in, the commands that they ran into a text file on a remote server.<br><br>
	
	For this project, we are using the <span class="linker"><a href="http://flask.pocoo.org/" target="_blank">Flask</a></span> microframework because it is lightweight and does not require an external server such as Apache to be installed for running applications. Flask is easy to install.<br><br>
	
	<span class="coder"><code>&#36; pip install flask</code></span><br><br>
	
	Then we wrote our Flask application to render HTML webpages upon request. The application stores userID and password pairs in a dictionary to authenticate users on login. Once the login is successful, the application renders another HTML page which contains a form having buttons corresponding to direction/speed control and sends it back to the server using POST. This page, rather a dashboard, is the primary interface to control the bot. It supports seven commands that can be sent to the bot.</p>

	<ul class="lister">
		<li>Forward</li>
		<li>Backward</li>
		<li>Right</li>
		<li>Left</li>
		<li>Fast</li>
		<li>Slow</li>
	</ul>
		
	<p class="contents">The layout of login screen and controller screen are shown in Fig. 2a and 2b respectively.</p>
		
	<figure class="linepics"><img class="pic3" src="img/login.jpg" alt="login screen"><figcaption class="caption2">Fig. 2a. Login screen</figcaption>
		</figure>
		
		
		<figure class="linepics"><img class="pic3" src="img/control.jpg" alt="conroller screen">
		<figcaption class="caption2">Fig. 2b. Controller screen</figcaption>
		</figure>
	
	<br><h3 class="Heading">Motor Control</h3>
	<p class="contents">
	The final part includes rigging up the bot chassis and interfacing the servos with the Pi. A regular servo motor is designed for 180 degrees swing i.e. 90 degrees to left of neutral position, and 90 degrees to right. Continuous Rotation (CR) servos are a modified version in which the shaft can rotate continuously by essentially removing the physical hard-stops. CR servos behave like compact DC gear motor with built in H-Bridge driver and can be controlled through a pulsed signal (like PWM).<br><br>

	For calibration, we send the servo a 1.5ms pulse refreshed every 20ms. Translating it into RPi, we use GPIO 19 to connect to the servo. The values for frequency and duty cycle are given below.<br><br>
		
	<code>Frequency = 1/(1.5 + 20) = 46.511 Hz</code><br>
	<code>Duty cycle = 1.5/(1.5 + 20) = 6.97%</code><br><br>
		
	As the length of the pulse decreases from 1.5ms to 1.3ms, the servo will gradually rotate faster in the clockwise direction [3], as shown in Fig. 3.<br></p>
	<figure>	
	<img id="servo" src="img/servo.png" alt="servo motor">
	<figcaption><span class="caption">Fig. 3. Full Speed clockwise rotation</span></figcaption>
	</figure>
		
	<p class="contents">To express full speed clockwise rotation in terms of RPi.GPIO, we define our duty cycle as below.<br><br>

	<code>Frequency = 1/(1.3 + 20) = 46.948 Hz</code><br>
	<code>Duty cycle = 1.3/(1.3 + 20) = 6.10%</code><br><br>
		
	Similarly, as we increase the pulse width from 1.5ms to 1.7ms, the servo attains it maximum speed in the counter-clockwise direction and we get,<br><br>

	<code>Frequency = 1/(1.7 + 20) = 46.082 Hz</code><br>
	<code>Duty cycle = 1.7/(1.7 + 20) = 7.83%</code><br><br>
		
	The safe way to connect servo motors to Raspberry Pi is to power the motors through a 6V battery or a regulated power supply of 6V. In this project, we are using 4 AA batteries to power the motors and a 5V portable rechargeable battery for Pi. The motors should not be connected to an unregulated power supply as the varying voltage can damage them. A generic connection diagram is shown in Fig. 4.<br></p>
		
	<figure>	
	<img class="conn" src="img/conn.png" alt="servo connection">
	<figcaption><span class="caption">Fig. 4. Servo motor connected with Raspberry Pi</span></figcaption>
	</figure>
		
	<p class="contents">In this project, we are using two servos that are connected to the GPIO pins 19 and 26 as shown in Fig. 5. Connecting the camera module is simple. We are using the official Raspberry Pi camera module v1, just connect it to the CSI port on the Pi and make sure it is enabled in the Pi configuration utility. Once the setup is complete, the bot should look like as in Fig. 6.</p>
		
	<figure class="linepics"><img class="pic2" src="img/ckt.png" alt="Circuit diagram"><figcaption class="caption2">Fig. 5. Raspberry Pi connection with servo motors</figcaption>
		</figure>
		
		
		<figure class="linepics"><img class="pic2" src="img/bot.png" alt="Completed Bot">
		<figcaption class="caption2">Fig. 6. Completed bot chassis</figcaption>
		</figure>	
		
	<hr>
    <h2 class="Heading" id="result">Result &amp; Conclusion</h2>
    <p class="contents">The primary goals of the project were achieved and the bot performed as expected. We were able to login and control the bot simultaneously from a PC (through Ad Hoc) and Android device (through Wi-Fi). We tested the bot at different locations to check its range. In absence of any obstacle (wall etc), the bot could be controlled for upto 100 meters. In presence of obstacles, the distance reduced to 15-20 meters. Additionally, we found out that the video feed's frame rate gets reduced over Wi-Fi as compared to that on the Ad Hoc network. The video feed screen and the backend server log are shown in Fig. 7 and 8 respectively.</p> 
		
	<figure class="linepics"><img class="pic2" src="" alt="video feed"><figcaption class="caption2">Fig. 7. Video feed from the camera module</figcaption>
		</figure>
		
		
	<figure class="linepics"><img class="pic2" src="" alt="backend server">
	<figcaption class="caption2">Fig. 8. Log generated by the backend server</figcaption></figure>
	
	<p class="contents">A demo video of the project is shown below.</p>
	<iframe id="vid" width="560" height="315" src="https://www.youtube.com/embed/nffpRMoaPTU" allowfullscreen></iframe>
		
	<h3 class="Heading">Future scope</h3>
		
	<ul class="lister">
		<li>The bot can be used for home surveillance purposes. It can navigate through the house and repot any suspicious activity.</li>
		<li>The bot can be employed for search and rescue operations at locations where it is hard for a human to go.</li>
	</ul>
	<hr>
		
	<h2 class="Heading" id="appendices">Appendices</h2>
	<h3 class="Heading">A. Code</h3>	
	<p class="contents">Due to the sheer amount of code and its maintenance, the entire project repo can be found <span class="linker"><a href="https://github.com/rxhl/Big-Red-Bot" target="_blank">here</a></span>.</p> 
	<h3 class="Heading">B. How to run Big-Red-Bot</h3>	
	
	<ul class="lister">
		<li>Download the project repo on your Pi.</li>
		<li><code>cd ~/../Big-Red-Bot</code></li>
		<li><code>sudo python controller.py</code></li>
		<li>On your device, goto http://a.b.c.d:800, where a.b.c.d is the IP address of your Pi.</li>
		<li>For the video feed, goto http://a.b.c.d:webopi</li>
		<li>Enjoy&#33;</li>
	</ul>
		
	<h3 class="Heading">C. Distribution of work</h3>	
	<p class="contents">
	The initial hardware setup was done by both Mahantesh and Rahul. Then, Mahantesh developed the wireframe for the Flask app, then both of them worked on the login screen. Once that was completed, Mahantesh worked on making the controller screen while Rahul worked on setting up the Ad Hoc network. The Ad Hoc ran successfully with PC but not any other platform and this was the major roadblock for the project. While Mahantesh added more functions to the controller screen and the back end server, Rahul worked on overcoming the networking problem by installing another Wi-Fi adapter to make the bot accessible from both and Ad Hoc and regular Wi-Fi in parallel.<br><br>
		
	Furthermore, Mahantesh interfaced the camera module while Rahul started documenting the project. While Mahantesh worked on cost analysis and future scope, Rahul designed the HTML/CSS template. Finally, both of them edited the report for the final version.
	</p>
	<h3 class="Heading">D. Bill of material</h3>	
	<table>
  <tr>
    <th>Item</th>
    <th>Unit Price ($)</th>
    <th>Quantity</th>
	<th>Total Price ($)</th>
  </tr>
  <tr>
    <td>Raspberry Pi 2</td>
    <td>35.00</td>
    <td>1</td>
	<td>35.00</td>
  </tr>
  <tr>
    <td>Servo motor</td>
    <td>5.95</td>
    <td>2</td>
	<td>11.90</td>
  </tr>
  <tr>
    <td>Edimax Wi-Fi adapter</td>
    <td>7.99</td>
    <td>1</td>
	<td>7.99</td>
  </tr>
  <tr>
    <td>Half size breadboard</td>
    <td>5.00</td>
    <td>1</td>
	<td>5.00</td>
  </tr>
	<tr>
    <td>AA battery</td>
    <td>0.40</td>
    <td>4</td>
	<td>1.60</td>
  </tr>
	<tr>
    <td></td>
    <td></td>
    <td></td>
	<td></td>
  </tr>
	<tr>
    <td class="total">Total amount</td>
    <td></td>
    <td></td>
	<td class="total">61.49</td>
  </tr>
</table>	
	<h3 class="Heading">E. References</h3>	
	<p class="contents"><span class="linker"><a href="http://www.edimax.com/edimax/merchandise/merchandise_detail/data/edimax/in/wireless_adapters_n150/ew-7811un/" target="_blank">[1] Edimax Wi-Fi adapter specifications</a></span><br><br>
	<span class="linker"><a href="https://spin.atomicobject.com/2013/04/22/raspberry-pi-wireless-communication/" target="_blank">[2] Configuring Ad Hoc network on Raspberry Pi</a></span><br><br>
	<span class="linker"><a href="https://www.parallax.com/sites/default/files/downloads/900-00008-Continuous-Rotation-Servo-Documentation-v2.2.pdf" target="_blank">[3] Parallax Continuous Rotation Servo (#900-00008) Datasheet</a></span><br><br>
	<span class="linker"><a href="http://www.springer.com/us/book/9781447166023" target="_blank">Embedded OS - A Practical Approach textbook</a></span><br><br>
	Lecture slides</p>
    
	
	<hr>
		
    <h2 class="Heading" id="team">Team</h2>
	
		<figure class="linepics"><a href="https://linkedin.com/in/rs2376" target="_blank"><img class="pic" src="img/xrx.png" alt="Rahul Sharma"></a><figcaption class="caption2">Rahul Sharma</figcaption>
		</figure>
		
		
		<figure class="linepics"><a href="https://linkedin.com/in/salimathmahantesh" target="_blank"><img class="pic" src="img/ms.jpg" alt="Mahantesh Salimath"></a>
		<figcaption class="caption2">Mahantesh Salimath</figcaption>
		</figure>	
		
			
    <hr>
		
	<h2 class="Heading" id="ack">Acknowledgement</h2>
    <p class="contents">We would like to acknowledge and thank Professor Joe Skovira for helping us throughout this project and for the wonderful class. We would also like to thank the fall 2016 TAs - Brandon, Jingyao and Jay for their support.</p> 
    <hr>
    
    <footer>
    <p class="contents">Thanks for visiting, let us know your views/suggestions/comments below.</p>      
    <div class="fb-comments" data-href="https://rxhl.github.io/Big-Red-Robot" data-numposts="5"></div>
		<div class="linker" id="footerText">&copy;2016 <a href="https://www.facebook.com/xrx19" target="_blank">Rahul Sharma</a>, <a href="https://www.facebook.com/mahantesh.salimath.37" target="_blank">Mahantesh Salimath</a></div>
    </footer>   
    </div>   
	</div>    

	<script type="text/javascript" src="js/script.js"></script>
	</body>
 
</html>